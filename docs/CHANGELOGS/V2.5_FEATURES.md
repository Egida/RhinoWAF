# RhinoWAF v2.5 - IPv6 Support

**Release Date:** November 2, 2025  
**Type:** Feature Release

## Overview

RhinoWAF v2.5 adds comprehensive IPv6 support across all security features, enabling full dual-stack operation for modern networks. This release ensures IPv4 and IPv6 traffic receives equal protection without any configuration changes.

## New Features

### Full IPv6 Support
- **Dual-Stack Operation**: Seamless handling of IPv4 and IPv6 connections
- **IP Normalization**: Automatic compression/expansion of IPv6 addresses
- **CIDR Matching**: Subnet-based rules work for both IPv4 (/24) and IPv6 (/64)
- **Private Range Detection**: Identifies IPv6 loopback, link-local, and ULA addresses
- **Type Detection**: Helper functions for IPv6 address classification

### Security Features
All existing security features now support IPv6:
- DDoS protection and rate limiting
- IP-based banning and whitelisting  
- GeoIP lookups and country blocking
- Connection tracking and Slowloris detection
- Request fingerprinting
- Reputation scoring

### IP Management
Enhanced IP rule system supports IPv6:
- Ban/whitelist IPv6 addresses in `ip_rules.json`
- Time-based restrictions
- Path and method filtering
- Request pattern validation
- All 119+ IP control fields work with IPv6

### Configuration
- Added IPv6 ranges to default GeoIP database:
  - `::1/128` - Loopback
  - `fc00::/7` - Unique Local Addresses
  - `fe80::/10` - Link-Local
  - `ff00::/8` - Multicast
- Trusted proxy configuration supports IPv6 CIDRs
- No breaking changes - existing IPv4 configs continue to work

## API Additions

### New Helper Functions

```go
// IP version detection
security.GetIPVersion("2001:db8::1") // Returns 6

// IPv6 type checking
security.IsIPv6("2001:db8::1")           // true
security.IsIPv6LinkLocal("fe80::1")      // true
security.IsIPv6UniqueLocal("fc00::1")    // true
security.IsIPv6Loopback("::1")           // true

// Address manipulation
security.ExpandIPv6("2001:db8::1")       // Full form
security.NormalizeIP("2001:0db8::1")     // Compressed
security.IsPrivateIP("fc00::1")          // true

// Subnet parsing
security.ParseIPWithSubnet("2001:db8::/32")
```

## Performance

IPv6 operations have minimal performance overhead:
- IP parsing: Same speed as IPv4 (43ns per operation)
- Normalization: 191ns with 1 allocation
- CIDR matching: Slightly slower than IPv4 (128-bit vs 32-bit)
- Memory: ~16 bytes per tracked IPv6 vs 4 bytes per IPv4

Benchmark results on AMD Ryzen 5 3600X:
```
BenchmarkIsIPv6-12        27,895,753 ops  43.98 ns/op  0 allocs
BenchmarkNormalizeIP-12    6,192,672 ops  191.4 ns/op  1 allocs
BenchmarkGetIPVersion-12  25,890,860 ops  43.03 ns/op  0 allocs
```

## Testing

Comprehensive test coverage added:
- Unit tests for all IPv6 helper functions (14 tests)
- GeoIP lookup tests for IPv6 ranges (5 tests)
- IP extraction from headers with IPv6
- Trusted proxy configuration with IPv6 CIDRs
- Integration tests covering DDoS, GeoIP, and IP management

All tests pass with 100% success rate.

## Migration Guide

### No Changes Required
Existing configurations work without modification. IPv6 support is automatic.

### Optional Enhancements
If you want to leverage IPv6 features:

1. **Add IPv6 trusted proxies** (if using IPv6 load balancers):
```go
security.SetTrustedProxies([]string{
    "::1/128",
    "fc00::/7",
    "2001:db8::/32",
})
```

2. **Configure IPv6 GeoIP ranges** in `geoip.json`:
```json
{
  "cidr": "2001:db8::/32",
  "country_code": "US",
  "country_name": "United States"
}
```

3. **Ban/whitelist IPv6 addresses** in `ip_rules.json`:
```json
{
  "banned_ips": [{
    "ip": "2001:db8::bad:actor",
    "type": "ban",
    "reason": "Malicious activity"
  }]
}
```

## Documentation

New documentation added:
- `docs/features/IPV6_SUPPORT.md` - Complete IPv6 guide
- API reference for IPv6 helper functions
- Configuration examples
- Testing instructions

## Known Limitations

- IPv6 zone identifiers (e.g., `fe80::1%eth0`) are not preserved
- Scope IDs are stripped during normalization
- Some legacy proxy headers may not format IPv6 correctly

## Future Enhancements

Planned for future releases:
- IPv6-specific rate limiting profiles
- Subnet-based tracking (/64 aggregation)
- IPv6 reputation databases
- ASN lookups for IPv6 ranges

## Breaking Changes

None. This release is fully backward compatible.

## Upgrade Instructions

1. Update to v2.5:
```bash
go get -u rhinowaf@v2.5
```

2. Restart RhinoWAF (no config changes needed)

3. Verify IPv6 support:
```bash
curl -6 http://[::1]:8080/health
```

## Contributors

- Core development team
- IPv6 implementation and testing

## Known Issues

None identified in testing.

## Support

For issues or questions:
- GitHub Issues: https://github.com/1rhino2/RhinoWAF/issues
- Documentation: docs/features/IPV6_SUPPORT.md
