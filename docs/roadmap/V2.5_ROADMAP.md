# v2.5 Roadmap - Critical Features Only

**Target Release**: Q1 2026  
**Priority**: CRITICAL  
**Status**: Planning Phase

## Overview

v2.5 addresses critical production needs: IPv6 support, better rate limiting, response caching, and proper logging. Everything else is deferred to v2.6+.

## Critical Features

### IPv6 Full Support âœ“
**Priority**: CRITICAL  
**Status**: COMPLETED

- Dual-stack IP handling (IPv4 + IPv6)
- IPv6 CIDR matching for GeoIP lookups
- Rate limiting keys for IPv6 addresses
- IP validation updates across all modules
- Blocked/allowed IP lists with IPv6 support

**Completed Modules**:
- `waf/security/ip.go`
- `waf/geo/geo.go`
- Comprehensive test coverage

### Advanced Rate Limiting
**Priority**: CRITICAL  
**Effort**: 3-4 days

Current fixed-window counter is insufficient for production DDoS protection. Need token bucket for burst handling.

**Implementation**:
- Token bucket algorithm with configurable refill rate
- Sliding window counter for smoother limiting
- Backward compatible with existing config
- Per-IP and per-user bucket tracking

**Config**:
```json
{
  "rate_limiting": {
    "algorithm": "token_bucket",
    "rate": 100,
    "burst": 200,
    "window": 60
  }
}
```

**Affected**: `waf/ddos/rate_limiter.go`

### Response Caching
**Priority**: CRITICAL  
**Effort**: 4-5 days

Without caching, backend gets hammered during attacks. Need in-memory cache with TTL.

**Implementation**:
- LRU cache with configurable size limit
- Path pattern matching for cacheable endpoints
- Cache-Control header parsing
- Automatic invalidation on TTL expiry

**Config**:
```json
{
  "cache": {
    "enabled": true,
    "max_mb": 256,
    "max_entries": 50000,
    "default_ttl": 300
  }
}
```

**New Module**: `waf/cache/response.go`

### Structured Logging
**Priority**: CRITICAL  
**Effort**: 2-3 days

Current log.Printf makes production debugging impossible. Need structured logs with levels.

**Implementation**:
- Replace all log.Printf with structured logger
- Log levels: ERROR, WARN, INFO, DEBUG
- JSON output for log aggregation
- Request ID correlation

**Library**: Use stdlib `log/slog` (no external deps)

**Affected**: All modules using log.Printf

## Performance Impact

- Response caching: 60-80% reduction in backend load
- Token bucket: Better burst handling, same throughput
- Structured logging: <2% overhead at INFO level
- IPv6: Already completed, <1% overhead

## Testing

- Unit tests for each feature
- Load testing with realistic traffic patterns
- Cache hit ratio validation
- Rate limiter burst handling tests

## Timeline

**Week 1-2**: Advanced rate limiting + tests  
**Week 3-4**: Response caching + tests  
**Week 5**: Structured logging migration  
**Week 6**: Integration testing + documentation

## Breaking Changes

None. All features are opt-in or backward compatible.

## Deferred to v2.6+

- Custom error templates (nice-to-have)
- Connection pooling improvements (optimization)
- GeoIP optimization (not critical)
- GraphQL support (niche use case)
- WebSocket security (separate focus area)
- gRPC proxy (separate focus area)
- Distributed tracing (complex, not critical)
- Custom Prometheus labels (nice-to-have)
- TLS cert hot-reload (workaround exists)
- Config validation tool (nice-to-have)
- Graceful degradation (complex, needs design)

## Version History

- **v2.4.1** (Oct 2025): OAuth2 + HTTP/3
- **v2.4.0** (Oct 2025): HTTP smuggling detection
- **v2.3.2** (Sep 2025): Health checks + JWT rate limiting
- **v2.3.1** (Aug 2025): Log rotation + webhooks
- **v2.3.0** (Jul 2025): Challenge system
