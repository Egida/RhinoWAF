# v2.5 Roadmap

**Target Release**: Q1 2026  
**Priority**: MEDIUM-HIGH  
**Status**: Planning Phase

## Overview

v2.5 focuses on performance improvements, protocol support expansion, and enhanced observability while maintaining backward compatibility with v2.4.x.

## Security Enhancements

### IPv6 Full Support
**Priority**: HIGH  
**Effort**: 3-5 days

- Dual-stack IP handling (IPv4 + IPv6)
- IPv6 CIDR matching for GeoIP lookups
- Rate limiting keys for IPv6 addresses
- IP validation updates across all modules
- Blocked/allowed IP lists with IPv6 support

**Affected Modules**:
- `waf/security/ip.go`
- `waf/ddos/ip_tracker.go`
- `waf/geo/geo.go`
- `config/ip_rules.json`

### Custom Error Page Templates
**Priority**: MEDIUM  
**Effort**: 2-3 days

- Template engine for branded error pages
- Fallback to default templates
- Variable substitution (IP, timestamp, error code)
- Configuration validation on load
- Per-error-code templates (403, 404, 429, 500)

**New Module**: `waf/templates/custom.go`

### Advanced Rate Limiting Algorithms
**Priority**: HIGH  
**Effort**: 4-6 days

Implement multiple algorithms beyond simple counter-based limiting:

- **Token Bucket**: Burst handling with token refill rate
- **Sliding Window**: Smoothed rate limiting across time windows
- **Leaky Bucket**: Queue-based request processing
- **Fixed Window Counter**: Current implementation (keep for compatibility)

**Configuration**:
```json
{
  "rate_limiting": {
    "algorithm": "token_bucket",
    "tokens_per_second": 10,
    "bucket_size": 50,
    "window_size": 60
  }
}
```

**Affected Module**: `waf/auth/ratelimit.go`

## Performance & Scalability

### Response Caching Layer
**Priority**: HIGH  
**Effort**: 5-7 days

- In-memory LRU cache with TTL
- Path pattern matching for cacheable endpoints
- Cache headers parsing (Cache-Control, Expires)
- Conditional requests (ETag, Last-Modified)
- Cache invalidation API
- Configurable max size and entry count

**New Module**: `waf/cache/response.go`

**Configuration**:
```json
{
  "response_cache": {
    "enabled": true,
    "max_size_mb": 100,
    "max_entries": 10000,
    "default_ttl": 300,
    "patterns": [
      {"path": "/api/static/*", "ttl": 3600},
      {"path": "/assets/*", "ttl": 86400}
    ]
  }
}
```

### Connection Pooling Improvements
**Priority**: MEDIUM  
**Effort**: 3-4 days

- Circuit breaker pattern for failing backends
- Health checks with exponential backoff
- Connection draining on shutdown
- Per-backend pool configuration
- Automatic retry with jitter

**Affected Module**: Backend proxy in `handlers/handlers.go`

### Optimized GeoIP Lookups
**Priority**: MEDIUM  
**Effort**: 2-3 days

- LRU cache for frequent IP lookups (10k entries)
- Binary search optimization for CIDR matching
- Parallel lookup support
- Lazy loading of GeoIP database
- Memory-mapped file support for large databases

**Affected Module**: `waf/geo/geo.go`

## Protocol Support

### GraphQL Query Depth Limiting
**Priority**: MEDIUM  
**Effort**: 4-5 days

- Parse GraphQL queries from request body
- Calculate query depth and complexity
- Configurable max depth (default: 10)
- Block excessively nested queries
- Metrics for GraphQL-specific attacks

**New Module**: `waf/graphql/validator.go`

### WebSocket Security
**Priority**: MEDIUM-HIGH  
**Effort**: 5-6 days

- WebSocket connection hijacking detection
- Payload size limits per message
- Rate limiting for WebSocket frames
- Protocol-specific fingerprinting
- Message inspection for attack patterns

**New Module**: `waf/websocket/security.go`

### gRPC Proxy Support
**Priority**: LOW-MEDIUM  
**Effort**: 6-8 days

- HTTP/2 gRPC traffic detection
- Method-level rate limiting
- Health check integration
- Metadata inspection
- Error handling and retries

**New Module**: `waf/grpc/proxy.go`

## Observability

### Custom Prometheus Labels
**Priority**: MEDIUM  
**Effort**: 2-3 days

- Dynamic label registration via config
- Custom collectors for business metrics
- Label cardinality limits (prevent explosion)
- Metric aggregation helpers

**Affected Module**: `waf/metrics/metrics.go`

**Configuration**:
```json
{
  "metrics": {
    "custom_labels": ["datacenter", "environment", "service"],
    "max_label_values": 1000
  }
}
```

### Distributed Tracing
**Priority**: LOW-MEDIUM  
**Effort**: 4-5 days

- OpenTelemetry integration
- Trace context propagation
- Span creation for each middleware
- Sampling configuration
- Export to Jaeger/Zipkin

**New Package**: `rhinowaf/tracing`

### Structured Logging
**Priority**: HIGH  
**Effort**: 3-4 days

- Replace fmt.Printf with structured logger (zerolog/zap)
- Log levels (DEBUG, INFO, WARN, ERROR)
- JSON output format
- Context propagation in logs
- Correlation IDs for request tracing

**Affected Module**: All logging throughout codebase

## Quality of Life

### Hot-Reload for TLS Certificates
**Priority**: MEDIUM  
**Effort**: 2-3 days

- Watch certificate files for changes
- Automatic reload without downtime
- Validation before applying new certs
- Rollback on invalid certificates
- Metrics for cert reload success/failure

**Affected Modules**: 
- `cmd/rhinowaf/main.go`
- `waf/http3/http3.go`

### Configuration Validation Tool
**Priority**: LOW-MEDIUM  
**Effort**: 2-3 days

- Standalone CLI tool for config validation
- JSON schema validation
- Dependency checking (e.g., OAuth2 requires certs)
- Warnings for suboptimal configs
- Example generation

**New Binary**: `rhinowaf-validate`

### Graceful Degradation
**Priority**: MEDIUM  
**Effort**: 3-4 days

- Continue operation if non-critical features fail
- Fallback to passthrough mode on panic
- Circuit breaker for external services (reputation, GeoIP)
- Degraded mode indicators in metrics
- Automatic recovery attempts

## Breaking Changes

None planned. v2.5 will be fully backward compatible with v2.4.x configurations.

## Migration Guide

No migration required from v2.4.x. New features are opt-in via configuration.

## Performance Impact

- Response caching: 50-80% reduction in backend load for cacheable content
- GeoIP optimization: 10-20% improvement in request latency
- Structured logging: 5-10% overhead (configurable log level mitigates)
- IPv6 support: Negligible impact (<1%)

## Testing Strategy

1. Unit tests for all new modules
2. Integration tests with real backends
3. Load testing with k6 (100k req/s target)
4. IPv6 network testing
5. WebSocket client testing (autobahn-testsuite)
6. gRPC testing with grpcurl
7. Cache invalidation correctness tests
8. Circuit breaker failure scenarios

## Dependencies

New dependencies to add:
- OpenTelemetry SDK (tracing)
- zerolog or zap (structured logging)
- grpc-go (gRPC support)
- gorilla/websocket (WebSocket handling)

## Timeline

**Month 1**: Security enhancements (IPv6, templates, rate limiting)  
**Month 2**: Performance work (caching, pooling, GeoIP)  
**Month 3**: Protocol support (GraphQL, WebSocket, gRPC)  
**Month 4**: Observability (tracing, logging, metrics)  
**Month 5**: QoL improvements and testing  
**Month 6**: Beta release and documentation

## Success Metrics

- 50% reduction in memory usage for session storage
- 30% improvement in request throughput
- Support for 100k concurrent WebSocket connections
- 99.99% uptime with graceful degradation
- Zero breaking changes for existing users

## Version History

- **v2.4.1** (Oct 2025): OAuth2 + HTTP/3
- **v2.4.0** (Oct 2025): HTTP smuggling detection
- **v2.3.2** (Sep 2025): Health checks + JWT rate limiting
- **v2.3.1** (Aug 2025): Log rotation + webhooks
- **v2.3.0** (Jul 2025): Challenge system
